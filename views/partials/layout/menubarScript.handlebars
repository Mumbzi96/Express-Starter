<script>
    // the languages that are in the application
    const locales = ["en-US","ar-SA"];
    // get the button
    const dropdownBtn = document.getElementById("dropdown-btn");
    // get the ul
    const dropdownMenu = document.getElementById("dropdown")
    const dropdownContent = document.getElementById("dropdown-content");


    // function to get the flag icon for the choosen language
    function getFlagSrc(countryCode) {
        return /^[A-Z]{2}$/.test(countryCode)
            ? `https://flagsapi.com/${countryCode.toUpperCase()}/shiny/64.png`
            : "";
    } 

    function openLanguageList(){
      if(dropdownContent.style.display === "none"){
          dropdownContent.style.display = "block";
      }else{
          dropdownContent.style.display = "none";
      }
    }

    function setSelectedLocale(locale) {
        const intlLocale = new Intl.Locale(locale);
        const langName = new Intl.DisplayNames([locale], { type: "language" }).of(intlLocale.language);

        dropdownContent.innerHTML = "";

        const otherLocales = locales.filter((loc) => loc !== locale);

        otherLocales.forEach((otherLocale) => {
            
            const otherIntlLocale = new Intl.Locale(otherLocale);
            const otherLangName = new Intl.DisplayNames([otherLocale], { type: "language", }).of(otherIntlLocale.language);
            const listEl = document.createElement("li");

            listEl.innerHTML = `${otherLangName}<img src="${getFlagSrc(otherIntlLocale.region)}" />`;
            listEl.value = otherLangName;

            listEl.addEventListener("mousedown", function () {
              fetch('{{#if navdata}} /users/menuchangelanguage {{else}} /changelanguage {{/if}}',{
                  headers: {
                    "Content-Type": "application/json"
                  },
                  method: "POST",
                  body: JSON.stringify({language: otherLangName})
              })
              .then( res => res.json())
              .then( data => {
                if (data.redirect) window.location = data.redirect
              })
              .catch ( err => console.error(err) )
            });

            dropdownContent.appendChild(listEl);

        });

        dropdownBtn.innerHTML = `<img src="${getFlagSrc( intlLocale.region )}" />${langName}<span class="arrow-down"></span>`;
    }

    // set first by default the first language in the array "locales"
    if('{{navdata}}') {
        if('{{navdata.language}}' == 'English') setSelectedLocale(locales[0]);
        else setSelectedLocale(locales[1])
    } else {
        if('{{webLanguage}}' == 'English') setSelectedLocale(locales[0]);
        else setSelectedLocale(locales[1])
    }
</script>