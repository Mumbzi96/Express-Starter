<script>
	// Selecting form and input elements
	const form = document.querySelector("form");
	const passwordInput = document.getElementById("password");
	const passToggleBtn = document.getElementById("pass-toggle-btn");
	const language = "{{webLanguage}}"

	// Function to display error messages
	const showError = (field, errorText) => {
		field.classList.add("error");
		const errorElement = document.createElement("small");
		errorElement.classList.add("error-text");
		errorElement.innerText = errorText;
		field.closest(".input-box").appendChild(errorElement);
	}

	// Function to handle form submission
	const handleFormData = (e) => {
		e.preventDefault();

		// Retrieving input elements
		const emailInput = document.getElementById("email");

		// Getting trimmed values from input fields
		const email = emailInput.value;
		const password = passwordInput.value;

		// Clearing previous error messages
		document.querySelectorAll(".input-box .error").forEach(field => field.classList.remove("error"));
		document.querySelectorAll(".error-text").forEach(errorText => errorText.remove());
				
		fetch("/login",{
			headers: {
				"Content-Type": "application/json"
			},
			method: "POST",
			body: JSON.stringify({"email": email, "password": password})
		})
		.then( res => res.json())
		.then((data)=> {
			if (data.emailErrorMessage) {
				showError(emailInput, data.emailErrorMessage);
			}

			if (data.passwordErrorMessage) {
				showError(passwordInput, data.passwordErrorMessage);
			}

			if(data.redirect) {
				window.location.href = `${data.redirect}`
			}
		})
		.catch( err => console.error(err))				
						
        // Checking for any remaining errors before form submission
        const errorInputs = document.querySelectorAll(".form-group .error");
	    if (errorInputs.length > 0) return;
	}

	// Handling form submission event
	form.addEventListener("submit", handleFormData);

	// Toggling password visibility
	passToggleBtn.addEventListener('click', () => {
	    passToggleBtn.className = passwordInput.type === "password" ? "fa-solid fa-eye-slash" : "fa-solid fa-eye";
		passwordInput.type = passwordInput.type === "password" ? "text" : "password";
	});

</script>